<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Generate — Coffee Process Code</title>
<link rel="stylesheet" href="css/styles.css">

<style>
/* v5.3 — Mobile-first, cherry palette, step UI + DnD fix */
:root{
  --bg:#E63E62;            /* cherry-rose primary */
  --card:#8F2A46;          /* deep plum for cards */
  --line:#6E1F36;          /* separators/borders */
  --muted:#FFD5E1;         /* soft rose for hints */
  --ink:#000000;           /* single-ink (black) for BeanTag/icons */
  --btn:#6B1631;           /* buttons background */
  --btnHover:#5A1229;
  --fg:#FFFFFF;            /* all text = white */
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
.wrap{max-width:900px;margin:0 auto;padding:16px}
header h1{font-size:20px;margin:6px 0 6px}
header p{margin:0;color:var(--fg);opacity:.9;font-size:14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:12px 0}

/* Timeline & rail (rail invisibile dentro i box) */
.timeline{position:relative}
.rail{position:absolute;left:50%;width:2px;background:var(--fg);opacity:.35;z-index:0;pointer-events:none}
#stepsWrap{position:relative} /* riferimento per drag assoluto */

/* Step box */
.step{position:relative;display:flex;flex-direction:column;gap:10px;
      padding:12px;border:1px solid var(--line);border-radius:12px;background:var(--card);
      margin:14px 0;z-index:1;transition:transform .18s ease;background-clip:padding-box}
.step.fixed{background:#7B2840;color:var(--fg)}

/* Tipografia “com’era prima” */
label{font-weight:600;font-size:14px}
.num{font-weight:700;font-size:16px;line-height:1;white-space:nowrap;padding:10px 6px 0 2px}

/* Campi */
.row{display:flex;flex-direction:column;gap:8px}
.grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
select,input,button{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);
  background:rgba(0,0,0,.18);color:var(--fg);font-size:16px}
select{cursor:pointer}
button{background:var(--btn);border:none;color:var(--fg);font-weight:700;cursor:pointer}
button:hover{background:var(--btnHover)}
button.ghost{background:transparent;border:1px solid var(--line);color:var(--fg)}
.actions{display:flex;gap:10px;justify-content:space-between;margin-top:6px}
.tiny{font-size:12px;color:var(--muted)}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.inline{display:flex;gap:10px;align-items:center}
.right{margin-left:auto}

/* Maniglia (drag) piccola a destra, non ruba spazio */
.handle{
  width:34px;height:46px;border:1px dashed var(--line);
  border-radius:10px;display:grid;place-items:center;
  color:var(--fg);cursor:grab;user-select:none;touch-action:none
}
.handle:active{cursor:grabbing}
.dots{width:14px;height:22px;opacity:.9}

/* X compatta in alto-destra */
.xbtn{
  position:absolute;right:8px;top:8px;width:28px;height:28px;border-radius:999px;
  border:1px solid var(--line);background:rgba(0,0,0,.18);color:var(--fg);font-weight:900;
  display:grid;place-items:center;cursor:pointer
}
.xbtn:hover{background:var(--btnHover)}

/* Ghost durante drag */
.step.drag-ghost{opacity:.9;box-shadow:0 8px 24px rgba(0,0,0,.25);z-index:99}

/* BeanTag area */
.bean{width:100%;display:flex;justify-content:center;align-items:center;
      padding:8px;background:#FFE7EE;border:1px dashed var(--line);border-radius:12px}
canvas#beanCanvas{width:min(64vw,260px);height:auto;background:#FFFFFF;border-radius:10px}

/* CPC box: 60% codice, 20% bottone */
.cpc-row{display:grid;grid-template-columns:20% 60% 20%;gap:12px;align-items:center}
#cpc{line-height:1.2;padding:6px 10px;background:rgba(0,0,0,.18);
     border:1px solid var(--line);border-radius:8px;max-height:2.2em;overflow:auto}
a.btn{display:inline-block;background:transparent;border:1px solid var(--line);
      color:var(--fg);text-decoration:none;padding:10px 12px;border-radius:10px}

/* Download menu */
.icon-btn{display:inline-flex;align-items:center;gap:8px}
.caret{margin-left:6px;border:solid var(--fg);border-width:0 2px 2px 0;display:inline-block;padding:3px;transform:rotate(45deg)}
.menu{position:relative;display:inline-block}
.menu-list{position:absolute;right:0;top:calc(100% + 6px);background:var(--card);border:1px solid var(--line);
           border-radius:10px;min-width:160px;display:none;z-index:10}
.menu-list a{display:block;padding:10px 12px;color:var(--fg);text-decoration:none;border-bottom:1px solid var(--line)}
.menu-list a:last-child{border-bottom:none}
.menu.open .menu-list{display:block}

/* Pulsanti quadrati piccoli (se usi ancora .square in qualche punto) */
.square{width:42px;min-width:42px;height:42px;display:grid;place-items:center;padding:0}
.trash{width:18px;height:18px;fill:var(--fg);opacity:.9}
</style>

  
</head><body>
<div class="wrap">
  <h1>CPC code and BeanTag generator</h1>
  <p class="lead">Enter all the steps that the beans went through, between picking and hullling.</p>

  <div class="timeline card">
    <div class="rail" id="rail" aria-hidden="true" style="top:0;height:0"></div>

    <div class="step fixed" id="fixed-start"><b>Picking</b></div>
    <div id="stepsWrap"></div>
    <div class="step fixed" id="fixed-end"><b>Hulling</b></div>
  </div>

  <div class="actions">
    <button id="addStep" class="icon-btn">＋ Add step</button>
    <button id="clearAll" class="ghost">Clear</button>
  </div>
  <div class="actions" style="margin-top:8px">
  <button id="gen" title="Generate CPC">Generate code</button>
</div>


  <div class="card">
    <div class="cpc-row">
  <b>CPC</b>
  <div id="cpcWrap">
    <div id="cpc" class="mono"></div>
    <button id="copyIcon" title="Copy CPC" aria-label="Copy CPC">
      <!-- tua icona SVG -->
      <svg viewBox="0 0 115.77 122.88" aria-hidden="true"><path d="M89.62,13.96v7.73h12.19v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82v73.27h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-61.7v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82H13.96v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82V13.96h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07h61.7v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82V13.96z M79.04,21.69v-7.73h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1h-61.7c-0.91,0-1.75,0.39-2.37,1.01c-0.61,0.61-1,1.46-1,2.37v64.59c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1h12.19V35.65c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07H79.04z M105.18,108.92V35.65c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1h-61.7c-0.91,0-1.75,0.39-2.37,1.01c-0.61,0.61-1,1.46-1,2.37v73.27c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1h61.7c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37z"/></svg>
    </button>
  </div>
</div>
    <div class="bean" id="beanPanel"><canvas id="beanCanvas" width="220" height="240" aria-label="BeanTag"></canvas></div>
    <div class="inline" style="justify-content:space-between;margin-top:8px">
      <a id="shareUrl" class="btn" href="#" target="_blank" rel="noopener">Open link</a>
      <div>
        <button id="dlPng" class="ghost">Download PNG</button>
        <button id="dlSvg" class="ghost">Download SVG</button>
      </div>
    </div>
    <p id="hint" class="tiny" style="margin-top:8px"></p>
  </div>
</div>

<script type="module" src="js/generator.js"></script>
</body></html>
